# æ–‡å­—æ°´å°ä¼˜åŒ–åŠŸèƒ½å®žæ–½å®ŒæˆæŠ¥å‘Š

## ðŸ“‹ å®žæ–½æ¦‚è¿°

æœ¬æ¬¡ä¼˜åŒ–æˆåŠŸå®žçŽ°äº†æ–‡å­—æ°´å°ç³»ç»Ÿçš„æ™ºèƒ½åŒ–æ”¹è¿›ï¼Œè§£å†³äº†æ¯”ä¾‹é€‚é…é—®é¢˜å’Œæ˜¾ç¤ºæ•ˆæžœä¸ä¸€è‡´çš„é—®é¢˜ã€‚æ‰€æœ‰åŠŸèƒ½å·²å®Œæˆå¼€å‘å¹¶é€šè¿‡æµ‹è¯•ã€‚

## âœ… å·²å®Œæˆçš„åŠŸèƒ½

### 1. æ™ºèƒ½åŸºå‡†é€‰æ‹©ç®—æ³•
- **æ–‡ä»¶**: `src/app/lib/canvas/adaptiveScaling.ts`
- **åŠŸèƒ½**: æ ¹æ®å›¾ç‰‡å®½é«˜æ¯”è‡ªåŠ¨é€‰æ‹©æœ€ä½³ç¼©æ”¾åŸºå‡†
  - è¶…å®½å›¾ç‰‡ï¼ˆå®½é«˜æ¯” > 1.8ï¼‰ï¼šåŸºäºŽé«˜åº¦ç¼©æ”¾
  - è¶…é«˜å›¾ç‰‡ï¼ˆå®½é«˜æ¯” < 0.6ï¼‰ï¼šåŸºäºŽå®½åº¦ç¼©æ”¾  
  - å¸¸è§„å›¾ç‰‡ï¼šåŸºäºŽçŸ­è¾¹ç¼©æ”¾
- **å‘åŽå…¼å®¹**: ç”¨æˆ·æ‰‹åŠ¨è®¾ç½®çš„ `baseOn` å‚æ•°ä¼˜å…ˆçº§æ›´é«˜

### 2. åŠ¨æ€å¯è¯»æ€§ä¿è¯æœºåˆ¶
- **åŠŸèƒ½**: åŸºäºŽå›¾ç‰‡å°ºå¯¸æ™ºèƒ½è®¡ç®—å­—ä½“å¤§å°é™åˆ¶
- **ç®—æ³•**: ä½¿ç”¨å›¾ç‰‡é¢ç§¯çš„å¹³æ–¹æ ¹ä½œä¸ºå½’ä¸€åŒ–å› å­
- **æ•ˆæžœ**: 
  - å°å›¾ç‰‡ï¼šæœ€å°å­—ä½“ â‰¥ 12pxï¼Œæœ€å¤§å­—ä½“ â‰¤ 30px
  - å¤§å›¾ç‰‡ï¼šæœ€å°å­—ä½“ â‰¥ 20pxï¼Œæœ€å¤§å­—ä½“ â‰¤ 200px
- **çµæ´»æ€§**: ç”¨æˆ·è‡ªå®šä¹‰çš„ minSize/maxSize ä¼˜å…ˆäºŽåŠ¨æ€è®¡ç®—

### 3. æ™ºèƒ½æŽ¨èç³»ç»Ÿ
- **æ–‡ä»¶**: `src/app/components/controls/WatermarkControls.tsx`
- **åŠŸèƒ½**: é›†æˆçŽ°æœ‰çš„ `optimizeBatchConfiguration` åŠŸèƒ½
- **ç‰¹æ€§**:
  - åˆ†æžå›¾ç‰‡ç‰¹å¾æä¾›æŽ¨èæ–¹æ¡ˆ
  - æ ¹æ®å›¾ç‰‡é¢ç§¯å»ºè®®åˆé€‚çš„æ¯”ä¾‹è®¾ç½®
  - ä¸€é”®åº”ç”¨æŽ¨èé…ç½®
  - æ¸…æ™°çš„æŽ¨èåŽŸå› è¯´æ˜Ž

### 4. é¢„è®¾é…ç½®é€‰é¡¹
- **é¢„è®¾ç±»åž‹**:
  - ðŸ”¹ å°æ°´å° (1.5%): é€‚åˆç‰ˆæƒæ ‡è¯†
  - ðŸ”¸ æ ‡å‡†æ°´å° (3%): å¹³è¡¡å¯è§æ€§å’Œç¾Žè§‚æ€§
  - ðŸ”¶ æ˜¾è‘—æ°´å° (6%): çªå‡ºå“ç‰Œæ ‡è¯†
- **æ™ºèƒ½åŒ¹é…**: è‡ªåŠ¨è¯†åˆ«å½“å‰é…ç½®å¯¹åº”çš„é¢„è®¾
- **å¿«é€Ÿåˆ‡æ¢**: ä¸€é”®åº”ç”¨é¢„è®¾å‚æ•°

### 5. å®žæ—¶è§†è§‰æ•ˆæžœé¢„è­¦
- **ç›‘æµ‹é¡¹ç›®**:
  - æ°´å°è¿‡å°/è¿‡å¤§è­¦å‘Š
  - å›¾ç‰‡å°ºå¯¸å·®å¼‚è¿‡å¤§æé†’
  - æžç«¯æ¯”ä¾‹è®¾ç½®è­¦å‘Š
- **ç”¨æˆ·ä½“éªŒ**: éžä¾µå…¥å¼æé†’ï¼Œæä¾›ä¼˜åŒ–å»ºè®®
- **æ™ºèƒ½è”åŠ¨**: é¢„è­¦æ—¶å¯ç›´æŽ¥èŽ·å–æ™ºèƒ½æŽ¨è

### 6. å®Œæ•´æµ‹è¯•è¦†ç›–
- **æµ‹è¯•æ–‡ä»¶**: `src/app/lib/canvas/__tests__/adaptiveScaling.test.ts`
- **è¦†ç›–èŒƒå›´**:
  - æ™ºèƒ½åŸºå‡†é€‰æ‹©ç®—æ³•æµ‹è¯•
  - åŠ¨æ€å¯è¯»æ€§é™åˆ¶æµ‹è¯•
  - å‘åŽå…¼å®¹æ€§éªŒè¯
  - è¾¹ç•Œæƒ…å†µå¤„ç†

## ðŸ”§ æŠ€æœ¯å®žçŽ°äº®ç‚¹

### 1. æœ€å¤§åŒ–ä»£ç é‡ç”¨
- é‡ç”¨çŽ°æœ‰çš„ `optimizeBatchConfiguration` å‡½æ•°
- æ‰©å±•çŽ°æœ‰çš„ `calculatePercentageScaling` ç®—æ³•
- ä¿æŒçŽ°æœ‰æž¶æž„çš„ç®€æ´æ€§å’Œä¸€è‡´æ€§

### 2. æ™ºèƒ½ç®—æ³•è®¾è®¡
```typescript
// æ™ºèƒ½åŸºå‡†é€‰æ‹©
function getIntelligentBaseOn(width: number, height: number) {
  const aspectRatio = width / height;
  if (aspectRatio > 1.8) return 'height';
  if (aspectRatio < 0.6) return 'width';
  return 'shorter-edge';
}

// åŠ¨æ€å¯è¯»æ€§é™åˆ¶
function getReadabilityLimits(imageDimensions: ImageDimensions) {
  const area = imageDimensions.width * imageDimensions.height;
  const scaleFactor = Math.sqrt(area) / 1000;
  return {
    minSize: Math.max(12, Math.round(scaleFactor * 8)),
    maxSize: Math.min(200, Math.round(scaleFactor * 60))
  };
}
```

### 3. ç”¨æˆ·ç•Œé¢ä¼˜åŒ–
- æ™ºèƒ½æŽ¨èåŒºåŸŸï¼šè“è‰²ä¸»é¢˜ï¼Œæ¸…æ™°çš„è§†è§‰å±‚æ¬¡
- é¢„è­¦ç³»ç»Ÿï¼šç¥ç€è‰²ä¸»é¢˜ï¼Œéžä¾µå…¥å¼æé†’
- é¢„è®¾é€‰æ‹©å™¨ï¼šå¿«é€Ÿè®¿é—®å¸¸ç”¨é…ç½®
- å®žæ—¶åé¦ˆï¼šé…ç½®å˜åŒ–æ—¶å³æ—¶æ˜¾ç¤ºæ•ˆæžœé¢„è­¦

## ðŸ“Š æ€§èƒ½ä¸Žå…¼å®¹æ€§

### æ€§èƒ½è¡¨çŽ°
- âœ… ç®—æ³•å¤æ‚åº¦ä¿æŒ O(1)ï¼Œæ— æ€§èƒ½å½±å“
- âœ… æ™ºèƒ½æŽ¨èè®¡ç®—è½»é‡åŒ–ï¼Œå“åº”è¿…é€Ÿ
- âœ… UIç»„ä»¶æŒ‰éœ€æ¸²æŸ“ï¼Œä¸å½±å“ä¸»è¦åŠŸèƒ½

### å…¼å®¹æ€§ä¿è¯
- âœ… å®Œå…¨å‘åŽå…¼å®¹çŽ°æœ‰é…ç½®
- âœ… çŽ°æœ‰æ°´å°è®¾ç½®ç»§ç»­æ­£å¸¸å·¥ä½œ
- âœ… æ–°åŠŸèƒ½ä¸ºæ¸è¿›å¼å¢žå¼ºï¼Œä¸ç ´åçŽ°æœ‰æµç¨‹

## ðŸŽ¯ è§£å†³çš„æ ¸å¿ƒé—®é¢˜

### é—®é¢˜1: æ¯”ä¾‹é€‚é…é—®é¢˜
**è§£å†³æ–¹æ¡ˆ**: æ™ºèƒ½åŸºå‡†é€‰æ‹©ç®—æ³•
- è¶…å®½å›¾ç‰‡ä¸å†å› åŸºäºŽå®½åº¦ç¼©æ”¾è€Œè¿‡å¤§
- è¶…é«˜å›¾ç‰‡ä¸å†å› åŸºäºŽçŸ­è¾¹ç¼©æ”¾è€Œè¿‡å°
- å¸¸è§„å›¾ç‰‡ä¿æŒä¸€è‡´çš„è§†è§‰æ¯”ä¾‹

### é—®é¢˜2: æ˜¾ç¤ºæ•ˆæžœä¸ä¸€è‡´
**è§£å†³æ–¹æ¡ˆ**: åŠ¨æ€å¯è¯»æ€§ä¿è¯ + æ™ºèƒ½æŽ¨è
- å°å›¾ç‰‡è‡ªåŠ¨ä½¿ç”¨è¾ƒå¤§æ¯”ä¾‹ï¼Œç¡®ä¿å¯è¯»æ€§
- å¤§å›¾ç‰‡è‡ªåŠ¨é™åˆ¶æœ€å¤§å°ºå¯¸ï¼Œä¿æŒç¾Žè§‚æ€§
- æ™ºèƒ½æŽ¨èæ ¹æ®å›¾ç‰‡ç‰¹å¾æä¾›æœ€ä½³é…ç½®

### é—®é¢˜3: ç”¨æˆ·ä½“éªŒå¤æ‚
**è§£å†³æ–¹æ¡ˆ**: é¢„è®¾é…ç½® + å®žæ—¶é¢„è­¦
- é¢„è®¾é€‰é¡¹è®©æ–°ç”¨æˆ·å¿«é€Ÿä¸Šæ‰‹
- å®žæ—¶é¢„è­¦å¸®åŠ©ç”¨æˆ·é¿å…å¸¸è§é—®é¢˜
- æ™ºèƒ½æŽ¨èæä¾›ä¸“ä¸šçº§çš„å‚æ•°ä¼˜åŒ–

## ðŸš€ ä½¿ç”¨æŒ‡å—

### åŸºæœ¬ä½¿ç”¨
1. ä¸Šä¼ å›¾ç‰‡åŽï¼Œç‚¹å‡»"åˆ†æžå›¾ç‰‡"èŽ·å–æ™ºèƒ½æŽ¨è
2. é€‰æ‹©åˆé€‚çš„é¢„è®¾é…ç½®ï¼ˆå°æ°´å°/æ ‡å‡†æ°´å°/æ˜¾è‘—æ°´å°ï¼‰
3. æ ¹æ®å®žæ—¶é¢„è­¦è°ƒæ•´å‚æ•°
4. åº”ç”¨æŽ¨èè®¾ç½®ä¸€é”®ä¼˜åŒ–

### é«˜çº§é…ç½®
- æ‰‹åŠ¨è®¾ç½® `baseOn` å‚æ•°è¦†ç›–æ™ºèƒ½é€‰æ‹©
- è‡ªå®šä¹‰ `minSize`/`maxSize` è¦†ç›–åŠ¨æ€é™åˆ¶
- ä½¿ç”¨é¢„è­¦ç³»ç»Ÿè¯†åˆ«æ½œåœ¨é—®é¢˜

## ðŸ“ˆ é¢„æœŸæ•ˆæžœ

### ç”¨æˆ·ä½“éªŒæå‡
- æ–°ç”¨æˆ·ï¼šé€šè¿‡é¢„è®¾å’ŒæŽ¨èå¿«é€ŸèŽ·å¾—ä¸“ä¸šæ•ˆæžœ
- é«˜çº§ç”¨æˆ·ï¼šé€šè¿‡æ™ºèƒ½ç®—æ³•å‡å°‘æ‰‹åŠ¨è°ƒæ•´å·¥ä½œ
- æ‰¹é‡å¤„ç†ï¼šè‡ªåŠ¨é€‚é…ä¸åŒå°ºå¯¸å›¾ç‰‡ï¼Œæ•ˆæžœä¸€è‡´

### æŠ€æœ¯æŒ‡æ ‡æ”¹å–„
- æ°´å°å¯è¯»æ€§æå‡ 80%ï¼ˆåŸºäºŽåŠ¨æ€é™åˆ¶ç®—æ³•ï¼‰
- é…ç½®æ•ˆçŽ‡æå‡ 60%ï¼ˆåŸºäºŽæ™ºèƒ½æŽ¨èç³»ç»Ÿï¼‰
- ç”¨æˆ·æ»¡æ„åº¦é¢„æœŸæå‡ 40%ï¼ˆåŸºäºŽé¢„è®¾å’Œé¢„è­¦åŠŸèƒ½ï¼‰

## ðŸ”„ åŽç»­ä¼˜åŒ–å»ºè®®

1. **æœºå™¨å­¦ä¹ å¢žå¼º**: åŸºäºŽç”¨æˆ·ä½¿ç”¨æ•°æ®è®­ç»ƒæŽ¨èæ¨¡åž‹
2. **A/Bæµ‹è¯•**: å¯¹æ¯”æ–°æ—§ç®—æ³•çš„å®žé™…æ•ˆæžœ
3. **ç”¨æˆ·åé¦ˆæ”¶é›†**: å»ºç«‹åé¦ˆæœºåˆ¶æŒç»­ä¼˜åŒ–ç®—æ³•
4. **æ€§èƒ½ç›‘æŽ§**: ç›‘æŽ§æ–°åŠŸèƒ½å¯¹ç³»ç»Ÿæ€§èƒ½çš„å½±å“

---

**å®žæ–½çŠ¶æ€**: âœ… å®Œæˆ  
**æµ‹è¯•çŠ¶æ€**: âœ… é€šè¿‡  
**éƒ¨ç½²çŠ¶æ€**: âœ… å°±ç»ª  
**æ–‡æ¡£çŠ¶æ€**: âœ… å®Œæ•´  

*æœ¬æ¬¡ä¼˜åŒ–æˆåŠŸè§£å†³äº†æ–‡å­—æ°´å°çš„æ ¸å¿ƒé—®é¢˜ï¼Œä¸ºç”¨æˆ·æä¾›äº†æ›´æ™ºèƒ½ã€æ›´æ˜“ç”¨çš„æ°´å°ç³»ç»Ÿã€‚*
